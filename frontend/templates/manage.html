{% extends "base.html" %}

{% block title %}Manage{% endblock %}

{% block navbar %}
<form class="form-inline">
	<input class="form-control mr-sm-2" type="text" placeholder="Search" name="search">
</form>
<form class="form-inline" action="/manage" method="POST">
	{% csrf_token %}
	<input type="hidden" name="action" value="add">
	<input class="form-control mr-sm-2" name="channel" type="text" placeholder="Add channel">
	<button class="btn btn-success" type="submit">Subscribe</button>
</form>
{% endblock %}


{% block content %}
<div style="margin: 50px;">
	<table class="table table-dark table-bordered table-striped">
		<thead class="container">
			<tr>
				<th class="col-4">Channel</th>
				<th class="col-4">Status</th>
				<th class="col-4"></th>
			</tr>
		</thead>
		<tbody class="container">
		</tbody>
	</table>
</div>

<div class="spinner-border text-light d-flex justify-content-center" style="margin-left: 50%; margin-top: 25%;" role="status">
	<span class="sr-only">Loading...</span>
</div>

<template>
	<tr>
		<td class="col-4" scope="row" id="channel"></td>
		<td class="col-4" id="id"></td>
		<td class="col-4"><form action="/manage" method="post">
			{% csrf_token %}
			<input type="hidden" name="channel" value="">
			<input type="hidden" name="action" value="delete">
			<button type="submit" class="btn btn-primary" >Unsubscribe</button>
		</form></td>
	</tr>
</template>
{% endblock %}

{% block scripts %}
{% load static %}
<script src="{% static 'frontend/loadSubbedEvents.js' %}" type="text/javascript"></script>
<script>
	let search = $("input[name^='search']");
	//add event listener to the input event
	//input event fires whenever the text is changed
	search.on("input", function(){
		let table = $("table").find("tbody > tr"); //all table rows
		table.find("td").parent().hide(); //hide all table rows
		//only show rows where the text in the search box is contained in the streamer's name
		table.find("td[id^='channel']").filter(function() {
			return $(this).text().toLocaleLowerCase().indexOf(search.val()) > -1; //custom case-insensitive search
		}).parent().show();
	});
</script>
{% endblock %}